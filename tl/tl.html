<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Timelapse Recorder</title>
  <link rel="manifest" href="site.webmanifest" crossorigin="use-credentials">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“·</text></svg>"/>
  <link rel="stylesheet" href="tl.css">
</head>
<body>
  <canvas id="tl-canvas"></canvas>
  <video id="tl-video" autoplay playsInline muted></video>
  <div id="panel-top">
    <fieldset class="fset"><legend>elapsed</legend>
      <div id="elapsed">00:00:00</div>
    </fieldset>
    <fieldset class="fset"><legend>recorded</legend>
      <div id="timer">00:00</div>
    </fieldset>
  </div>
  <div id="panel-bottom">
    <div id='div-table'>
      <table id='table-caps'>
        <thead id="thead">
          <th>h1</th>
          <th>h2</th>
          <th>h3</th>
          <th>h4</th>
          <th>h5</th>
          <th>h6</th>
          <th>h7</th>
          <th>h8</th>
          <th>h9</th>
        </thead>
        <tbody id="tdata">
          <td>d1</td>
          <td>d2</td>
          <td>d3</td>
          <td>d1</td>
          <td>d2</td>
          <td>d3</td>
          <td>d1</td>
          <td>d2</td>
          <td>d3</td>
        </tbody>
      </table>
    </div>
    <div style="display: flex; align-items: center; justify-content: center;">
    <div id="record-btn-div">
      <input id="startStop" type="checkbox" onclick="startStop()"/><label for="startStop"></label>
    </div>
  </div>
  </div>
  <script>
    const video = document.getElementById('tl-video');
    const canvas = document.getElementById('tl-canvas');
    const elapsed = document.getElementById('elapsed');
    
    var timer;
    var ctx;
    var t0;

    function capture(){
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      let e = Date.now() - t0;
      elapsed.innerHTML = new Date(e).toISOString().slice(11, 19);
    }

    function startStop(){
      if (video.style.display !== 'none'){
        video.style.display = 'none';
        canvas.style.display = 'block'
        t0 = Date.now();
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx = canvas.getContext('2d');
        timer = setInterval(capture, 1000);
      } else {
        clearInterval(timer);
        video.style.display = 'block';
        canvas.style.display = 'none'
      }
    }

    function init(stream){
      video.srcObject = stream;
      video.play();
    }

    navigator.mediaDevices
      .getUserMedia({ video: true, audio: false })
      .then((stream) => init(stream))
      .catch((err) => {
        log.innerText = `An error occurred: ${err}`;
      });
  </script>
</body>
</html>